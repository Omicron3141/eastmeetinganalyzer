{# This simple template derives from ``base.html``. See ``base.html`` for
   more information about template inheritance. #}
{%- extends "base.html" %}

{# Loads some of the macros included with Flask-Bootstrap. We are using the
   utils module here to automatically render Flask's flashed messages in a
   bootstrap friendly manner #}
{% import "bootstrap/utils.html" as utils %}


{# Inside the ``content`` is where you should place most of your own stuff.
   This will keep scripts at the page end and a navbar you add on later
   intact. #}
{% block content %}
  <head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-127801815-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-127801815-1');
    </script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.3.0/Chart.min.js"></script>

    <title>EDC - East Data Console</title>

  </head>

  <body id="page-top">

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg bg-secondary fixed-top text-uppercase" id="mainNav">
      <div class="container">
        <div class="row">
          <div class="col-5 white-text"><h1>EDC - East Data Console</h1></div>
        </div>
      </div>
    </nav>

<center>
    <div class="row tabs">
      <div style="width:70%"></div>
      <a href="/" style="width:17.5%" class="btn btn-tab">Home</a>
      <a href="/leaderboard"  style="width:17.5%" class="btn btn-tab">Leaderboards</a>
      <a href="/individual" style="width:17.5%" class="btn btn-tab active">Individual Stats</a>
      <a href="/about" style="width:17.5%" class="btn btn-tab">About</a>

    </div>
  </center>

  <hr>

  <center><h1>EAST DATA CONSOLE - INDIVIDUAL STATS</h1>

  <br><br>
  <div class="form-group">
    <label for="SearchBar">Search for Name:</label>
    <input oninput="search()" type="text" class="form-control" style="width:500px" id="SearchBar" placeholder="Harry F">
  </div>
  <div id="results" style="width: 70%">

  </div>

  <canvas id="chart" width="2000" height="800"></canvas>
  </center>

<script>
var setup = false;
function setUpChart(){  
  var options = {
          responsive: true,
          scales: {
            xAxes: [{
              stacked: true,
              ticks: {
                autoSkip: false
            }
            }],
            yAxes: [{
              stacked: true
            }]
          }
};
var barData = {
   labels : [],
   datasets : [
      {
        backgroundColor: "rgba(0,150,0,0.9)",
        label: "Real Comments",
        data : []
      },
      {
        backgroundColor: "rgba(150,0,0,0.9)",
        label: "Meme Comments",
        data : []
      }
      ]
   }

var ctx = document.getElementById("chart").getContext("2d");
myBar = new Chart(ctx, {
        type: 'bar',
        data: barData,
        options: options
      });
}
names = [{% for name in names %} '{{name}}', {% endfor %}];

function search(){
  var term = document.getElementById("SearchBar").value.toLowerCase();
  results = names.filter(name => name.toLowerCase().search(term) != -1);
  resultString = ""
  if (results.length == 0){
    resultString = "No results found. Try a different name.";
  }
  for (i = 0; i < 5 && i < results.length; i++) {
    id = names.indexOf(results[i]);
    resultString = resultString + "<span id='name-"+id+"' class='btn btn-tab' style='width: 14%' onclick='loadData("+id+")'>"+results[i]+"</span>";
  }
  $("#results").html(resultString);
}
var currentPerson = -1;
function loadData(person){
  $.get("/person?person="+person, function(data, status){
      if (status == "success") {
      if (!setup) {
        setUpChart();
        setup = true;
      }
      myBar.data.labels = data['meetings'];
      myBar.data.datasets[0].data = data['real'];
      myBar.data.datasets[1].data = data['meme'];
      myBar.update();
      if ($("#name-"+currentPerson).length != 0){
        $("#name-"+currentPerson).removeClass("active");
      }
      currentPerson = person;
      if ($("#name-"+currentPerson).length != 0){
        $("#name-"+currentPerson).addClass("active");
      }
    }
  });
}
</script>

    <div class="copyright py-4 text-center white-text">
      <div class="container">
        <small>Copyright &copy; Jonah Rubin 2018</small>
      </div>
    </div>

    <!-- Scroll to Top Button (Only visible on small and extra-small screen sizes) -->
    <div class="scroll-to-top d-lg-none position-fixed ">
      <a class="js-scroll-trigger d-block text-center text-white rounded" href="#page-top">
        <i class="fa fa-chevron-up"></i>
      </a>
    </div>
  </body>

{%- endblock %}

